name: Reusable workflow
on:
  workflow_call:
    inputs:
      location:
        default: 'https://portal.diakrit.com/v3/api/releases'
        required: false
        type: string
      repo:
        required: true
        type: string
      ref_name:
        required: true
        type: string
      commit:
        required: true
        type: string
      ref_type:
        required: true
        type: string
      target_dir:
        required: true
        type: string
    secrets:
      token:
        required: true

jobs:
  resuable_jobs:
    runs-on: [self-hosted, Linux]
    steps:
      - name: Zip target folder
        run: (cd ${{ inputs.target_dir }} && zip -r ${GITHUB_WORKSPACE}/tmp.zip .)

      - name: Upload zipped file
        run: |
          curl --location --request POST '${{ inputs.location }}' \
          --header "Authorization: Bearer ${{ secrets.token }}" \
          --form 'repo="${{ inputs.repo }}"' \
          --form 'ref_name="${{ inputs.ref_name }}"' \
          --form 'ref_type="${{ inputs.ref_type }}"' \
          --form 'commit="${{ inputs.commit }}"' \
          --form 'file=@"tmp.zip"'
